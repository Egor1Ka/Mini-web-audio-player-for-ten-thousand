{"ast":null,"code":"class AudioDriver {\n  constructor(audioFile) {\n    this.audioFile = void 0;\n    this.audioContext = void 0;\n    this.audioBuffer = undefined;\n    this.gainNode = undefined;\n    this.bufferSource = undefined;\n    this.startedAt = 0;\n    this.pausedAt = 0;\n    this.isRunning = false;\n    this.volume = 1;\n    this.audioFile = audioFile; // Sound data\n\n    this.audioContext = new AudioContext(); // AudioContext provides us access for hardware speakers\n  }\n\n  async init() {\n    this.audioBuffer = await this.audioContext.decodeAudioData(this.audioFile);\n  }\n\n  getDuretion() {\n    return this.audioBuffer;\n  }\n\n  async play() {\n    if (!this.audioBuffer) {\n      throw new Error('Play error. Audio buffer is not exists. Try to call \"init\" method before Play.');\n    }\n\n    if (this.isRunning) {\n      return;\n    }\n\n    this.gainNode = this.audioContext.createGain(); // create a volume controller\n\n    this.bufferSource = this.audioContext.createBufferSource(); // create buffer source which allows us to play a sound\n\n    this.bufferSource.buffer = this.audioBuffer; // add AudioBuffer (sound data) to buffer source\n\n    this.bufferSource.connect(this.gainNode); // connecting volume controller to buffer source\n\n    this.bufferSource.connect(this.audioContext.destination); // connect buffer source to hardware speakers\n\n    this.gainNode.connect(this.audioContext.destination); // connect volume controller to hardware speakers\n\n    await this.audioContext.resume(); // resume all speakers\n\n    this.bufferSource.start(0, this.pausedAt); // run the sound. pausedAt remembers a last pause time\n\n    this.gainNode.gain.value = this.volume; // setup default volume\n\n    this.startedAt = this.audioContext.currentTime - this.pausedAt; // remember the time when we run the sound\n\n    this.pausedAt = 0;\n    this.isRunning = true;\n    console.log(this.gainNode);\n    console.log(this.audioContext.currentTime, 'audio Context');\n  }\n\n  async pause(reset) {\n    var _this$gainNode;\n\n    if (!this.bufferSource) {\n      return;\n    }\n\n    await this.audioContext.suspend(); // stop using hardware speakers\n\n    this.pausedAt = reset ? 0 : this.audioContext.currentTime - this.startedAt; // calculate pause time or reset to 0\n\n    this.bufferSource.stop(this.pausedAt); // stop playing sound\n\n    (_this$gainNode = this.gainNode) === null || _this$gainNode === void 0 ? void 0 : _this$gainNode.disconnect(); // disconnect volume controller\n\n    this.bufferSource.disconnect(); // remove buffer source from hardware speakers. We can't reuse the same buffer source, always should be new one.\n\n    this.isRunning = false;\n  }\n\n  changeVolume(volume) {\n    this.volume = volume;\n\n    if (this.gainNode) {\n      this.gainNode.gain.value = volume;\n    }\n  }\n\n  ChengeSoubndTime(value) {}\n\n}\n\nexport default AudioDriver;","map":{"version":3,"names":["AudioDriver","constructor","audioFile","audioContext","audioBuffer","undefined","gainNode","bufferSource","startedAt","pausedAt","isRunning","volume","AudioContext","init","decodeAudioData","getDuretion","play","Error","createGain","createBufferSource","buffer","connect","destination","resume","start","gain","value","currentTime","console","log","pause","reset","suspend","stop","disconnect","changeVolume","ChengeSoubndTime"],"sources":["C:/Users/Егор/Desktop/player/src/components/audioPlayer/drive.ts"],"sourcesContent":["class AudioDriver {\n  private readonly audioFile;\n\n  private audioContext: AudioContext;\n  private audioBuffer?: AudioBuffer = undefined;\n  private gainNode?: GainNode = undefined;\n\n  private bufferSource?: AudioBufferSourceNode = undefined;\n\n  private startedAt = 0;\n  private pausedAt = 0;\n  private isRunning = false;\n\n  private volume = 1;\n\n  constructor(audioFile: ArrayBuffer) {\n    this.audioFile = audioFile; // Sound data\n    this.audioContext = new AudioContext(); // AudioContext provides us access for hardware speakers\n  }\n\n  async init() {\n    this.audioBuffer = await this.audioContext.decodeAudioData(this.audioFile);\n  }\n\n  public getDuretion(){\n    return this.audioBuffer\n  }\n\n  public async play() {\n    if (!this.audioBuffer) {\n      throw new Error(\n        'Play error. Audio buffer is not exists. Try to call \"init\" method before Play.'\n      );\n    }\n\n    if (this.isRunning) {\n      return;\n    }\n\n    this.gainNode = this.audioContext.createGain(); // create a volume controller\n\n    this.bufferSource = this.audioContext.createBufferSource(); // create buffer source which allows us to play a sound\n    this.bufferSource.buffer = this.audioBuffer; // add AudioBuffer (sound data) to buffer source\n\n    this.bufferSource.connect(this.gainNode); // connecting volume controller to buffer source\n    this.bufferSource.connect(this.audioContext.destination); // connect buffer source to hardware speakers\n\n    this.gainNode.connect(this.audioContext.destination); // connect volume controller to hardware speakers\n\n    await this.audioContext.resume(); // resume all speakers\n\n    this.bufferSource.start(0, this.pausedAt); // run the sound. pausedAt remembers a last pause time\n\n    this.gainNode.gain.value = this.volume; // setup default volume\n\n    this.startedAt = this.audioContext.currentTime - this.pausedAt; // remember the time when we run the sound\n    this.pausedAt = 0;\n\n    this.isRunning = true;\n\n    console.log(this.gainNode)\n    console.log(this.audioContext.currentTime,'audio Context')\n  }\n\n  async pause(reset?: boolean) {\n    if (!this.bufferSource) {\n      return;\n    }\n\n    await this.audioContext.suspend(); // stop using hardware speakers\n\n    this.pausedAt = reset ? 0 : this.audioContext.currentTime - this.startedAt; // calculate pause time or reset to 0\n    this.bufferSource.stop(this.pausedAt); // stop playing sound\n    this.gainNode?.disconnect(); // disconnect volume controller\n    this.bufferSource.disconnect(); // remove buffer source from hardware speakers. We can't reuse the same buffer source, always should be new one.\n    this.isRunning = false;\n  }\n\n  public changeVolume(volume: number) {\n    this.volume = volume;\n\n    if (this.gainNode) {\n      this.gainNode.gain.value = volume;\n    }\n  }\n\n  public ChengeSoubndTime(value:number){\n    \n  } \n}\n\nexport default AudioDriver;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}